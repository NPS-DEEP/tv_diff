# This makefile does the following:
# * generates .py from .ui built using QT Designer.
#   We archive the generated .py file so that users do not
#   need to install pyuic5 and do not need to rebuild .py from .ui,
#   likely done with python3 -m pip install PyQt5.
# * generates version_file.py to match VERSION defined here.
#   We archive version_file.py so users don't have to type "make" first.
#
# You do not need to run this makefile unless you:
# * change a .ui file.
# * change the VERSION.

VERSION = 1.0.0
ZIP_DIR = exe_similarity-$(VERSION)
ZIP = $(ZIP_DIR).zip

generated_files = settings_dialog.py

.SUFFIXES: .ui .py

.ui.py:
	pyuic5 $< > $@

all: $(generated_files) version_file.py

dist: zip

version_file.py: Makefile
	@echo Updating version_file.py to $(VERSION)
	@echo "# This file is auto-generated by Makefile.  Do not edit this file." > version_file.py
	@echo "VERSION = \"$(VERSION)\"" >> version_file.py

zip:
	rm -rf $(ZIP_DIR)
	mkdir $(ZIP_DIR)
	mkdir $(ZIP_DIR)/python
	cp *.py $(ZIP_DIR)/python
	mkdir $(ZIP_DIR)/python/icons
	cp icons/*.png $(ZIP_DIR)/python/icons
	mkdir $(ZIP_DIR)/python/sbatch_graph_500
	cp sbatch_graph_500/*.csv $(ZIP_DIR)/python/sbatch_graph_500
	mkdir $(ZIP_DIR)/python/sbatch_tv_500
	cp sbatch_tv_500/*.tv $(ZIP_DIR)/python/sbatch_tv_500

	zip -r $(ZIP) $(ZIP_DIR)
	rm -rf $(ZIP_DIR)

# just clean distribution files
clean:
	/bin/rm -rf $(ZIP)

.PHONY: zip
